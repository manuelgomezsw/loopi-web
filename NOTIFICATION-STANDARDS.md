# üì¢ Est√°ndares de Notificaciones - Loopi Web

## üéØ Objetivo

Este documento establece los patrones est√°ndar para el manejo de notificaciones
en la aplicaci√≥n Loopi Web, garantizando una experiencia de usuario consistente
y un c√≥digo mantenible.

## ‚úÖ Sistema √önico: SnackBar (Material Design)

### üöÄ Servicio Principal

```typescript
import { NotificationService } from '../core/services/notification/notification.service';

// Inyecci√≥n en componentes
private notificationService = inject(NotificationService);
```

### üìã Tipos de Notificaci√≥n

#### 1. **Success** - Operaciones exitosas

```typescript
this.notificationService.success('Empleado creado exitosamente');
this.notificationService.success('Turno asignado correctamente');
```

#### 2. **Error** - Errores y fallos

```typescript
this.notificationService.error('Error al cargar los datos');
this.notificationService.error('No se pudo guardar la informaci√≥n');
```

#### 3. **Warning** - Advertencias

```typescript
this.notificationService.warning('Los datos no est√°n completos');
this.notificationService.warning('Sesi√≥n pr√≥xima a expirar');
```

#### 4. **Info** - Informaci√≥n general

```typescript
this.notificationService.info('Datos actualizados autom√°ticamente');
this.notificationService.info('Nueva versi√≥n disponible');
```

## üèóÔ∏è Patrones de Implementaci√≥n

### 1. **Componentes con Store (NgRx)**

#### ‚úÖ Patr√≥n Recomendado:

```typescript
export class MyComponent implements OnInit, OnDestroy {
  private store = inject(Store<AppState>);
  private notificationService = inject(NotificationService);
  private destroy$ = new Subject<void>();

  // Error observable privado
  private error$: Observable<string | null> = this.store.select(selectMyError);

  ngOnInit(): void {
    // Suscribirse a errores del store
    this.error$
      .pipe(
        filter(error => !!error),
        takeUntil(this.destroy$)
      )
      .subscribe(error => {
        this.notificationService.error(error!);
      });
  }

  ngOnDestroy(): void {
    this.destroy$.next();
    this.destroy$.complete();
  }
}
```

#### ‚ùå Evitar:

```typescript
// NO usar divs de error en templates
<div *ngIf="error$ | async as error" class="error-container">
  {{ error }}
</div>
```

### 2. **Servicios HTTP Directos**

#### ‚úÖ Patr√≥n Recomendado:

```typescript
loadData(): void {
  this.myService.getData().subscribe({
    next: (data) => {
      this.data = data;
      this.notificationService.success('Datos cargados exitosamente');
    },
    error: (error) => {
      console.error('Error loading data:', error); // Para debugging
      this.notificationService.error('Error al cargar los datos');
    }
  });
}
```

#### ‚ùå Evitar:

```typescript
// NO solo console.error sin notificaci√≥n al usuario
error: error => {
  console.error('Error:', error); // Solo esto NO es suficiente
};
```

### 3. **Effects (NgRx)**

#### ‚úÖ Patr√≥n Recomendado:

```typescript
loadData$ = createEffect(() =>
  this.actions$.pipe(
    ofType(MyActions.loadData),
    switchMap(() =>
      this.myService.getData().pipe(
        map(data => MyActions.loadDataSuccess({ data })),
        catchError(error => {
          const errorMessage = extractBackendErrorMessage(error);
          return of(MyActions.loadDataFailure({ error: errorMessage }));
        })
      )
    )
  )
);

// Effect separado para manejar errores
handleError$ = createEffect(
  () =>
    this.actions$.pipe(
      ofType(MyActions.loadDataFailure),
      tap(({ error }) => {
        this.notificationService.error(error);
      })
    ),
  { dispatch: false }
);
```

## üé® Caracter√≠sticas del SnackBar

### ‚ú® Ventajas

- **Material Design compliant** - Dise√±o consistente
- **No ocupa espacio** - No empuja contenido existente
- **Auto-dismiss** - Se ocultan autom√°ticamente
- **Stacking inteligente** - Maneja m√∫ltiples notificaciones
- **Posici√≥n fija** - Siempre en la misma ubicaci√≥n
- **Acciones opcionales** - Botones en notificaciones

### ‚öôÔ∏è Configuraci√≥n Avanzada

```typescript
// Con opciones personalizadas
this.notificationService.error('Error cr√≠tico', {
  duration: 10000,
  showCloseButton: true
});

// Con acciones
this.notificationService.warning('Sesi√≥n expirando', {
  action: 'Renovar',
  onAction: () => this.renewSession()
});
```

## üö´ Patrones Prohibidos

### ‚ùå NO Usar:

1. **Divs de error en templates**

   ```html
   <!-- PROHIBIDO -->
   <div *ngIf="error$ | async as error" class="error-message">{{ error }}</div>
   ```

2. **Solo console.error sin notificaci√≥n**

   ```typescript
   // PROHIBIDO - Usuario no ve el error
   error: error => {
     console.error('Error:', error);
   };
   ```

3. **alert() o window.alert()**

   ```typescript
   // PROHIBIDO - No es profesional
   alert('Error occurred!');
   ```

4. **Sistema de Store UI personalizado**
   ```typescript
   // PROHIBIDO - Ya eliminado
   this.store.dispatch(addNotification({ ... }));
   ```

## üîß Manejo Global de Errores

### GlobalErrorHandler

El `GlobalErrorHandler` maneja autom√°ticamente:

- **Errores HTTP** (401, 403, 404, 500, etc.)
- **Errores de red** (sin conexi√≥n)
- **Errores de JavaScript** (runtime errors)

```typescript
// Configurado autom√°ticamente - NO requiere intervenci√≥n manual
// Ubicaci√≥n: src/app/core/handlers/global-error.handler.ts
```

## üìä Casos de Uso Comunes

### 1. **Formularios**

```typescript
save(): void {
  if (this.form.invalid) {
    this.notificationService.error('Por favor completa todos los campos requeridos');
    return;
  }

  // Procesar formulario...
}
```

### 2. **Operaciones CRUD**

```typescript
// Crear
this.notificationService.success('Registro creado exitosamente');

// Actualizar
this.notificationService.success('Registro actualizado correctamente');

// Eliminar
this.notificationService.success('Registro eliminado exitosamente');

// Error en cualquier operaci√≥n
this.notificationService.error('Error al procesar la solicitud');
```

### 3. **Validaciones de Contexto**

```typescript
if (!workContext) {
  this.notificationService.error(
    'No se ha seleccionado una tienda. Por favor, selecciona un contexto de trabajo.'
  );
  this.router.navigate(['/']);
  return;
}
```

## üéØ Beneficios de la Estandarizaci√≥n

### ‚úÖ Para Usuarios:

- **Experiencia consistente** - Todas las notificaciones se ven y comportan
  igual
- **Mejor UX** - No interrumpen el flujo de trabajo
- **Informaci√≥n clara** - Mensajes comprensibles y √∫tiles

### ‚úÖ Para Desarrolladores:

- **C√≥digo limpio** - Un solo patr√≥n para seguir
- **F√°cil mantenimiento** - Cambios centralizados
- **Testing simplificado** - Un solo sistema para probar
- **Menos bugs** - Patr√≥n probado y estable

## üöÄ Migraci√≥n de C√≥digo Legacy

### Antes (Sistema Dual):

```typescript
// ‚ùå Div de error
<div *ngIf="error$ | async as error" class="error-container">
  {{ error }}
</div>

// ‚ùå Solo console.error
error: (error) => {
  console.error('Error:', error);
}
```

### Despu√©s (Sistema √önico):

```typescript
// ‚úÖ SnackBar autom√°tico desde Store
ngOnInit(): void {
  this.error$.pipe(
    filter(error => !!error),
    takeUntil(this.destroy$)
  ).subscribe(error => {
    this.notificationService.error(error!);
  });
}

// ‚úÖ SnackBar directo en servicios
error: (error) => {
  console.error('Error:', error); // Para debugging
  this.notificationService.error('Mensaje amigable para el usuario');
}
```

## üìù Checklist de Implementaci√≥n

### ‚úÖ Para Nuevos Componentes:

- [ ] Importar `NotificationService`
- [ ] Inyectar servicio con `inject()`
- [ ] Usar m√©todos apropiados (`success`, `error`, `warning`, `info`)
- [ ] NO crear divs de error en templates
- [ ] Implementar `OnDestroy` si se suscribe a observables

### ‚úÖ Para Componentes Existentes:

- [ ] Remover divs de error del HTML
- [ ] Eliminar estilos CSS de error
- [ ] Agregar suscripci√≥n a error$ del Store
- [ ] Reemplazar console.error con notificaciones
- [ ] Implementar gesti√≥n de memoria (`takeUntil`)

---

## üéâ Resultado Final

**Sistema Unificado de Notificaciones:**

- ‚úÖ **Un solo mecanismo** - SnackBar Material Design
- ‚úÖ **Experiencia consistente** - Misma UX en toda la app
- ‚úÖ **C√≥digo mantenible** - Patr√≥n est√°ndar documentado
- ‚úÖ **Performance optimizada** - Sin c√≥digo duplicado
- ‚úÖ **F√°cil testing** - Sistema centralizado

---

_√öltima actualizaci√≥n: Septiembre 2025_ _Versi√≥n: 1.0_
